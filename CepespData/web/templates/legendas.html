{% extends "layout.html" %}

{% block styles %}

    <link rel="stylesheet" type="text/css"
          href="{{ 'plugins/datatables/extensions/Scroller/css/dataTables.scroller.min.css'|asset }}"/>
    <link rel="stylesheet" type="text/css"
          href="{{ 'plugins/datatables/extensions/ColReorder/css/dataTables.colReorder.min.css'|asset }}"/>
    <link rel="stylesheet" type="text/css"
          href="{{ 'plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css'|asset }}"/>
    <link rel="stylesheet" type="text/css" href="{{ 'plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css'|asset }}"/>
    <link rel="stylesheet" type="text/css" href="{{ 'plugins/bootstrap-modal/css/bootstrap-modal.css'|asset }}"/>
    <link rel="stylesheet" type="text/css" href="{{ 'plugins/select2/select2.css'|asset }}"/>

{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-md-12">

            <div class="portlet light">
                <div class="portlet-title">
                    <div class="caption font-green-haze">
                        <i class="icon-briefcase"></i>
                        <span class="caption-subject bold uppercase">
                            {{ gettext('pages.home.political-parties') }}
                        </span>
                    </div>
                </div>
                <div class="portlet-body form">

                    <p>{{ gettext('pages.home.political-parties-description') }}</p>

                    <form action="/consulta/legendas" method="get">

                        <div class="form-body">
                            <div class="row">
                                <div class="form-group col-md-3 col-xs-12">
                                    <label for="job-input">{{ gettext('pages.query.job') }}:</label>
                                    <select name="cargo" id="job-input" class="form-control" required>
                                        <option value="1" {% if options.job == 1 %} selected{% endif %}>{{ gettext('query.job.1') }}</option>
                                        <option value="3" {% if options.job == 3 %} selected{% endif %}>{{ gettext('query.job.3') }}</option>
                                        <option value="5" {% if options.job == 5 %} selected{% endif %}>{{ gettext('query.job.5') }}</option>
                                        <option value="6" {% if options.job == 6 %} selected{% endif %}>{{ gettext('query.job.6') }}</option>
                                        <option value="7" {% if options.job == 7 %} selected{% endif %}>{{ gettext('query.job.7') }}</option>
                                        <option value="11" {% if options.job == 11 %} selected{% endif %}>{{ gettext('query.job.11') }}</option>
                                        <option value="13" {% if options.job == 13 %} selected{% endif %}>{{ gettext('query.job.13') }}</option>
                                    </select>
                                </div>

                                <div class="form-group col-md-3 col-xs-12">
                                    <label for="year-input">{{ gettext('pages.query.year') }}:</label>
                                    <select name="anos[]" id="year-input" class="form-control" multiple required>
                                        {% for x in years %}
                                            <option value="{{ x }}"{% if x in options.years %} selected{% endif %}>{{ x }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn blue">{{ gettext('pages.home.query') }}</button>
                        </div>
                    </form>

                </div>
            </div>

            <div class="portlet box blue" id="table-area" style="display: none">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-globe"></i>Results
                    </div>
                    <div class="actions">
                        <a href="https://github.com/Cepesp-Fgv/tse-dados/issues" target="_blank" class="btn btn-default">
                            <i class="fa fa-github"></i>
                            {{ gettext('pages.query.report-error') }}
                        </a>
                        <button class="btn btn-primary table-tools" data-target="#columns-modal" data-toggle="modal">
                            <i class="fa fa-list"></i>
                            {{ gettext('pages.query.add-columns') }}
                        </button>
                        <button class="btn btn-primary table-tools" id="clear-btn" disabled>
                            <i class="fa fa-pencil"></i>
                            {{ gettext('pages.query.clear-filters') }}
                        </button>
                        <button class="btn btn-success table-tools" id="donwload-btn">
                            <i class="glyphicon glyphicon-download-alt"></i>
                            CSV
                        </button>
                        <a href="javascript:" class="btn btn-default btn-icon-only fullscreen" data-original-title="" title=""></a>
                    </div>
                </div>
                {% if show %}
                <div class="portlet-body">
                    <table class="table table-striped table-bordered table-hover" id="query-table"></table>
                </div>
                {% endif %}
            </div>

        </div>
    </div>


    <!-- columns modal -->
    <div id="columns-modal" class="modal container fade" tabindex="-1">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
            <h4 class="modal-title">
                {{ gettext('pages.query.add-columns') }}
            </h4>
        </div>
        <form action="/consulta/legendas" method="get">
            <input type="hidden" name="cargo" id="modal-cargo-input" value="{{ options.job }}"/>
            <input type="hidden" name="anos" id="modal-anos-input" value="{{ options.years|join(',') }}"/>
            <div class="modal-body" style="max-height: 300px; overflow: scroll">
                <div class="row">
                    {% for column in options.all_columns %}
                        <div class="col-md-4">
                            <div class="md-checkbox">
                                <input type="checkbox" name="c[]" id="columns-{{ loop.index0 }}" class="md-check" value="{{ column }}" {% if column in options.selected_columns %}checked{% endif %}>
                                <label for="columns-{{ loop.index0 }}">
                                    <span></span>
                                    <span class="check"></span>
                                    <span class="box"></span>
                                    <b>{{ gettext('columns.' + column) }}</b><br/>
                                    <small class="text-success">{{ gettext('descriptions.' + column) }}</small>
                                </label>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-default">{{ gettext('pages.query.cancel') }}</button>
                <button type="button" class="btn green-haze" id="select-default">{{ gettext('pages.query.select-default') }}</button>
                <button type="button" class="btn green" id="select-all">{{ gettext('pages.query.select-all') }}</button>
                <button type="submit" class="btn blue">{{ gettext('pages.query.update-table') }}</button>
            </div>
        </form>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ 'plugins/datatable/js/jquery.dataTables.js'|asset }}"></script>
    <script src="{{ 'plugins/datatables/extensions/Scroller/js/dataTables.scroller.min.js'|asset }}"
            type="text/javascript"></script>
    <script src="{{ 'plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js'|asset }}"
            type="text/javascript"></script>
    <script src="{{ 'plugins/bootstrap/js/bootstrap.min.js'|asset }}"></script>
    <script src="{{ 'plugins/bootstrap-toastr/toastr.min.js'|asset }}"></script>
    <script src="{{ 'plugins/fileDownload/jquery.fileDownload.js'|asset }}"></script>
    <script src="{{ 'plugins/bootstrap-modal/js/bootstrap-modalmanager.js'|asset }}"></script>
    <script src="{{ 'plugins/bootstrap-modal/js/bootstrap-modal.js'|asset }}"></script>
    <script src="{{ 'plugins/select2/select2.min.js'|asset }}"></script>
    <script src="{{ 'js/query_12.js'|asset }}"></script>
    <script type="text/javascript">
        var COLUMNS = {{ options.selected_columns|tojson }};
        var DEFAULT_COLUMNS = {{ options.default_columns|tojson }};
        var TRANSLATED_COLUMNS = {{ options.translated_columns|tojson }};
        var ENDPOINT = '/api/consulta/legendas';

        {% if show %}
            populateTable();
        {% endif %}
    </script>
{% endblock %}